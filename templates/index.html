<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kargo Asistanı</title>
    <style>
        body {
            /* Arka plan rengi */
            background-color: #f0f2f5;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
            overflow: hidden; /* Kaydırma çubuklarını engelle */
        }

        /* --- BOTU BÜYÜTME AYARLARI --- */
        df-messenger {
            /* Renk Ayarları */
            --df-messenger-bot-message: #e0f2fe;
            --df-messenger-button-titlebar-color: #3b82f6;
            --df-messenger-chat-background-color: #ffffff;
            --df-messenger-font-color: #333;
            --df-messenger-send-icon: #3b82f6;
            --df-messenger-user-message: #dbeafe;

            /* Bot Penceresinin Boyutları */
            --df-messenger-chat-window-height: 600px;
            --df-messenger-chat-window-width: 450px;

            /* Mobilde tam ekran olsun */
            @media (max-width: 768px) {
                --df-messenger-chat-window-height: 100%;
                --df-messenger-chat-window-width: 100%;
            }
        }
    </style>
</head>
<body>

    <!-- Yükleniyor Mesajı (Bot gelene kadar görünür) -->
    <div id="loading-text" style="text-align: center; color: #64748b; position: absolute;">
        <p>Asistan Yükleniyor...</p>
    </div>

    <!-- Dialogflow Kodunuz -->
    <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
    <df-messenger
      intent="WELCOME"
      chat-title="Yardimci-Musteri"
      agent-id="a1e7ef35-1001-4e5f-b46e-3f2b37cb6bff"
      language-code="tr"
      expand="true"
    ></df-messenger>

    <!--
       KESİN ORTALAMA SCRIPT'İ
       setInterval kullanarak botun Shadow DOM'u oluştuğu anda yakalayıp
       CSS ile zorla ortalıyoruz.
    -->
    <script>
        // Her 100 milisaniyede bir botun yüklenip yüklenmediğini kontrol et
        const checkExist = setInterval(function() {
            const dfMessenger = document.querySelector('df-messenger');

            // Eğer bot ve onun gölge kökü (Shadow DOM) oluşmuşsa
            if (dfMessenger && dfMessenger.shadowRoot) {

                // 1. Özel stil elementini oluştur
                const style = document.createElement('style');
                style.textContent = `
                    div.chat-wrapper {
                        /* Pozisyonu sabitle */
                        position: fixed !important;

                        /* Tam ortala: Üstten ve Soldan %50 it, sonra kendi boyutu kadar geri çek */
                        top: 50% !important;
                        left: 50% !important;
                        transform: translate(-50%, -50%) !important;

                        /* Eski alt/sağ ayarlarını sıfırla */
                        bottom: auto !important;
                        right: auto !important;

                        /* Görünüm ayarları */
                        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
                        border-radius: 12px !important;
                        z-index: 9999 !important;
                    }

                    /* Sağ alttaki yuvarlak butonu tamamen yok et */
                    button#widgetIcon {
                        display: none !important;
                    }
                    .df-messenger-wrapper img {
                        display: none !important;
                    }

                    /* Mobilde tam ekran */
                    @media (max-width: 768px) {
                        div.chat-wrapper {
                            top: 0 !important;
                            left: 0 !important;
                            transform: none !important;
                            width: 100% !important;
                            height: 100% !important;
                            border-radius: 0 !important;
                        }
                    }
                `;

                // 2. Stili botun içine enjekte et
                dfMessenger.shadowRoot.appendChild(style);

                // 3. Botu açık kalmaya zorla
                dfMessenger.setAttribute('expand', 'true');

                // 4. Yükleniyor yazısını kaldır
                const loadingText = document.getElementById('loading-text');
                if(loadingText) loadingText.style.display = 'none';

                // 5. İşlem tamam, döngüyü durdur
                clearInterval(checkExist);
                console.log("Bot başarıyla ortalandı.");
            }
        }, 100); // 100ms aralıklarla kontrol
    </script>

</body>
</html>